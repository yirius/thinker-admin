/** thinker-admin-css-v1.0.0 MTI License By https://github.com/yirius/thinker-admin-css.git */
 ;layui.extend({loadBar:"lay/modules/loadBar",dropdown:"lay/modules/dropdown"}).define(["jquery","laytpl","element","form","loadBar","dropdown"],function(e){var c=layui.jquery,f=layui.laytpl,h=layui.conf,s=layui.loadBar,t=(layui.dropdown,c(window),c(document)),m=(c("body"),{ie8:"Microsoft Internet Explorer"==navigator.appName&&"MSIE8.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,""),container:c("#"+h.views.container),containerBody:null,checkHtml:function(e){return/<[^>]+>/g.test(e)},loading:function(e){e.append(this.elemLoad=c('<i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon layui-icon-loading thinker-loading"></i>'))},loaded:function(){this.elemLoad&&this.elemLoad.remove()},setTitle:function(e){t.attr({title:e+" - "+h.views.name})},clear:function(){m.containerBody.html("")},popup:function(e){var a=e.success,t=e.skin;return delete e.success,delete e.skin,layui.layer.open(c.extend({type:1,title:"温馨提示",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(t?" "+t:""),shadeClose:!0,success:function(e,t){var n=c('<i class="layui-icon" close>&#x1006;</i>');e.append(n),n.on("click",function(){layer.close(t)}),"function"==typeof a&&a.apply(this,arguments)}},e))},error:function(e,t){return this.popup(c.extend({content:e,maxWidth:300,shade:.01,offset:"t",anim:6,id:"Thinker_adminError"},t))},session:{get:function(e){return this.has(e)?layui.data(h.tableName)[e]:null},has:function(e){return e in layui.data(h.tableName)},set:function(e,t){layui.data(h.tableName,{key:e,value:t})},remove:function(e){layui.data(h.tableName,{key:e,remove:!0})},clear:function(){layui.data(h.tableName,null)},token:function(){return this.get(h.tokenName)||""},login:function(e,t){this.set(h.tokenName,e),c.isPlainObject(t)&&layui.each(t,function(e){m.session.set(e,t[e])})},logout:function(){this.remove(h.tokenName),location.hash=h.login.loginPage}},_parseRequest:function(t){t.data=t.data||{},t.headers=t.headers||{};try{"string"==typeof t.data&&(t.data=JSON.parse(t.data))}catch(e){h.debug&&console.error(e),t.data={}}if(t.data=c.extend(t.data,h.request.data),t.headers=c.extend(t.headers,h.request.headers),h.tokenName){var e=0==h.request.tokenType?"headers":"data";void 0===t[e][h.tokenName]&&(t[e][h.tokenName]=m.session.token())}return t},request:function(r){return delete(r=m._parseRequest(r)).success,delete r.error,c.ajax(c.extend({type:"get",dataType:"json",success:function(e){var t=h.response.statusCode;if(e[h.response.statusName]==t.logout)m.session.logout();else if(e[h.response.statusName]==t.expired){var n=e[h.response.dataName][h.tokenName];if(delete e[h.response.dataName][h.tokenName],m.session.login(n,e[h.response.dataName]),h.tokenName){var a=0==h.request.tokenType?"headers":"data";void 0!==r[a][h.tokenName]&&delete r[a][h.tokenName]}m.request(r)}else if(e[h.response.statusName]==t.ok)"function"==typeof r.done&&r.done(e);else{var i=!1;"function"==typeof r.complete&&(i=r.complete(1,e)||!1),i||m.error("<cite>Error：</cite> "+(e[h.response.msgName]||"返回状态码异常"))}},error:function(e,t){m.error("请求异常，服务器貌似出现一些问题<br><cite>错误信息：</cite>"+t),"function"==typeof r.complete&&r.complete(0,t)}},r))},parse:function(o){o=o||m.containerBody;function l(e,t,n){f(e.html()).render(t,function(t){try{t=c(m.checkHtml(t)?t:"<span>"+t+"</span>")}catch(e){t=c("<span>"+t+"</span>")}t.attr("is-template",!0),e.after(t),c.isFunction(n)&&n(t)})}var u=this,d=layui.router(),e="SCRIPT"==o.get(0).tagName?o:o.find("[template]");layui.each(e,function(e,t){var n=(t=c(t)).attr("lay-done")||t.attr("lay-then"),a=f(t.attr("lay-url")||"").render(d),i=f(t.attr("lay-type")||"POST").render(d),r=f(t.attr("lay-data")||"").render(d),s=f(t.attr("lay-headers")||"").render(d);try{r=new Function("return "+r+";")()}catch(e){h.debug&&console.error(t,"lay-data: "+e.message),r={}}try{s=new Function("return "+s+";")()}catch(e){h.debug&&console.error(t,"lay-headers: "+e.message),s=s||{}}if(a)u.request({url:a,type:i,data:r,header:s,done:function(e){l(t,e[h.response.dataName]);try{n&&new Function(n)()}catch(e){h.debug&&console.error(t+"layDone error: "+e)}}});else{l(t,{},m.ie8?function(e){e[0]&&"LINK"!=e[0].tagName||(o.hide(),e.load(function(){o.show()}))}:null);try{n&&new Function(n)()}catch(e){h.debug&&console.error(t+"layDone error: "+e)}}})},loadHtml:function(i,r){var e=(i=i||h.views.entry).indexOf("?");if(i=(0===i.indexOf(h.views.base)?"":h.views.views)+i,-1!==e){var t=i.split("?");i=t[0]+h.views.engine+"?v="+layui.cache.version+"&"+t[1]}else i=i+h.views.engine+"?v="+layui.cache.version;s.start(),c.ajax(m._parseRequest({url:i,type:"get",dataType:"html",success:function(e){if("{"==e.substr(0,1)){var t=h.response.statusCode,n=JSON.parse(e);if(n[h.response.statusName]==t.logout)s.finish(),m.session.logout();else if(n[h.response.statusName]==t.expired){var a=n[h.response.dataName][h.tokenName];delete n[h.response.dataName][h.tokenName],m.session.login(a,n[h.response.dataName]),s.finish(),m.loadHtml(i,r)}else s.error(),m.error("请求视图文件异常\n文件路径："+i+"\n状态："+n[h.response.msgName])}else r({html:e,url:i}),s.finish()},error:function(e){m.error("请求视图文件异常\n文件路径："+i+"\n状态："+e.status),s.error()}}))},fillHtml:function(e,t,n){var a=t.find(".layui-fluid[lay-title]"),i="";0<a.length&&(i=a.attr("lay-title"),m.setTitle(i));var r=m.containerBody||m.container;return r[n](t.html()),"prepend"==n?m.parse(r.children('[lay-url="'+e+'"]')):m.parse(r),layui.element.render("breadcrumb","thinker-breadcrumb"),{title:i,url:e,htmlElem:t}},tab:{isInit:!1,data:[],tabMenuTplId:"TPL-app-tabsmenu",minLeft:null,maxLeft:null,wrap:".thinker-tabs-wrap",menu:".thinker-tabs-menu",next:".thinker-tabs-next",prev:".thinker-tabs-prev",step:200,init:function(){var s=this,e=s.wrap+" .thinker-tabs-btn";layui.dropdown.render({elem:".thinker-tabs-down",click:function(e){"all"==e?s.delAll():"other"==e?s.delOther():"current"==e&&s.del(c(".thinker-tabs-menu").find(".thinker-tabs-active").attr("lay-url"))},options:[{name:"current",title:"关闭当前选项卡"},{name:"other",title:"关闭其他选项卡"},{name:"all",title:"关闭所有选项卡"}]}),t.on("click",e,function(e){var t=c(this).attr("lay-url");if(c(e.target).hasClass("thinker-tabs-close"))s.del(t);else{var n=c(this).attr("data-type");if("page"==n)s.change(s.has(t));else if("prev"==n||"next"==n){s.menuElem=c(s.menu);var a=s.menuElem;s.minLeft=s.minLeft||parseInt(a.css("left")),s.maxLeft=s.maxLeft||c(s.next).offset().left;var i=0;if("prev"==n)(i=parseInt(a.css("left"))+s.step)>=s.minLeft&&(i=s.minLeft);else{i=parseInt(a.css("left"))-s.step;var r=a.find("li:last");if(r.offset().left+r.width()<s.maxLeft)return}a.css("left",i)}}}),c(".thinker-tabs-hidden").addClass("layui-show"),this.isInit=!0},has:function(n){var a=!1;return layui.each(this.data,function(e,t){if(t.fileurl==n)return a=t}),a},delAll:function(e){var t=this,n=t.menu+" .thinker-tabs-btn";c(n).each(function(){var e=c(this).attr("lay-url");if(e===h.views.entry)return!0;t.del(e)})},delOther:function(){var t=this,e=t.menu+" .thinker-tabs-btn";c(e+".thinker-tabs-active").siblings().each(function(){var e=c(this).attr("lay-url");t.del(e)})},del:function(n,e){var a=this;if(!(a.data.length<=1&&void 0===e)){layui.each(a.data,function(e,t){if(t.fileurl==n)return a.data.splice(e,1),!0});var t='[lay-url="'+n+'"]',i=c("#"+h.views.containerBody+" > .thinker-tabs-item"+t),r=c(this.menu).find(t);r.remove(),i.remove(),void 0===e&&r.hasClass("thinker-tabs-active")&&c(this.menu+" li:last").click()}},refresh:function(e){e=e||layui.admin.route.fileurl,this.has(e)&&(this.del(e,!0),m.renderTabs(e))},clear:function(){this.data=[],this.isInit=!1,c(document).off("click",this.wrap+" .thinker-tabs-btn")},change:function(a,i){"string"==typeof a&&((a=layui.router("#"+a)).fileurl="/"+a.path.join("/"));var r=a.fileurl,s=this;0==s.isInit&&s.init();function o(e){c("#"+h.views.containerBody+" > .thinker-tabs-item"+e).show().siblings().hide()}var l='[lay-url="'+r+'"]',u="thinker-tabs-active",e=s.has(r);if(e){var t=c(this.menu),n=t.find(l);if(e.href!==a.href)return s.del(e.fileurl,!0),s.change(a),!1;n.addClass(u).siblings().removeClass(u),o(l),this.minLeft=this.minLeft||parseInt(t.css("left"));var d=n.offset().left;d-this.minLeft-c(this.next).width()<0?c(this.prev).click():d-this.minLeft>.5*t.width()&&c(this.next).click(),c(document).scrollTop(-100),layui.admin.navigate(a.href)}else m.loadHtml(r,function(e){var t=c("<div><div class='thinker-tabs-item' lay-url='"+r+"'>"+e.html+"</div></div>"),n=m.fillHtml(r,t,"prepend");a.title=n.title,s.data.push(a),layui.admin.render(s.tabMenuTplId),c(s.menu+" "+l).addClass(u),o(l),c.isFunction(i)&&i(n)});layui.admin.sidebarFocus(a.href)},onChange:function(){}},render:function(e,a){m.loadHtml(e,function(e){var t=c("<div>"+e.html+"</div>"),n=m.fillHtml(e.url,t,"html");c.isFunction(a)&&a(n)})},renderTabs:function(e,t){this.tab.change(e,t)},renderLayout:function(t,e){e=e||h.views.layout,this.containerBody=null,this.render(e,function(e){m.containerBody=c("#"+h.views.containerBody),1==h.views.viewTabs&&m.containerBody.addClass("thinker-tabs-body"),layui.admin.appBody=m.containerBody,c.isFunction(t)&&t()})},renderIndPage:function(e,t){m.renderLayout(function(){m.containerBody=null,c.isFunction(t)&&t()},e)}});e("view",m)});