/** thinker-admin-v1.0.0 MIT License By http://www.thinkphp-admin.com/ */
 ;layui.define(["jquery","xlsx","FileSaver"],function(e){var t=layui.jquery,n=layui.xlsx,i=layui.FileSaver;e("excel",{downloadExl:function(e,t,n){n=n?n:"xlsx",this.exportExcel({sheet1:e},t+"."+n,n)},exportExcel:function(e,r,a,o){a=a?a:"xlsx",r=r?r:"导出数据."+a;var l=n.utils.book_new(),s={Title:r,Subject:"Export From web browser",Author:"excel.thinkeradmin.com",Manager:"",Company:"",Category:"",Keywords:"",Comments:"",LastAuthor:"",CreatedData:new Date};o&&o.Props&&(s=t.extend(s,o.Props)),l.Props=s;var u={"!merges":null,"!margins":null,"!cols":null,"!rows":null,"!protect":null,"!autofilter":null};o&&o.extend&&(u=t.extend(u,o.extend));for(var c in u)u[c]||delete u[c];t.isArray(e)&&(e={sheet1:e});for(var h in e){var f=e[h];l.SheetNames.push(h);var p=!1;if(f.length&&f[0]&&t.isArray(f[0])&&(p=!0),p)var v=n.utils.aoa_to_sheet(f);else{var d={};if(f.length){d.headers=f.unshift(),d.skipHeader=!0;var x=this.splitContent(f)}var v=n.utils.json_to_sheet(f,d);u[h]?t.extend(v,u[h]):t.extend(v,u),"undefined"!=typeof x&&this.mergeCellOpt(v,x.style)}l.Sheets[h]=v}var m=n.write(l,{bookType:a,type:"binary",cellStyles:!0});i(new Blob([this.s2ab(m)],{type:"application/octet-stream"}),r)},splitContent:function(e){var t={};for(line in e){var n=e[line],i=0;for(var r in n){var a=n[r];"object"==typeof a&&(null!==a?t[this.numToTitle(i+1)+(parseInt(line)+1)]=a:n[r]=""),i++}}return{content:e,style:t}},mergeCellOpt:function(e,n){for(var i in n){var r=n[i];if(e[i]){var a=["t","w","f","r","h","c","z","l","s"];for(var o in a)e[i][a[o]]=e[i][a[o]];t.extend(e[i],r)}}},numsTitleCache:{},titleNumsCache:{},numToTitle:function(e){if(this.numsTitleCache[e])return this.numsTitleCache[e];var t="";if(e>26){var n=e%26;return t=this.numToTitle((e-n)/26)+this.numToTitle(n?n:26),this.numsTitleCache[e]=t,this.titleNumsCache[t]=e,t}return t=String.fromCharCode(64+e),this.numsTitleCache[e]=t,this.titleNumsCache[t]=e,t},titleToNum:function(e){if(this.titleNumsCache[e])return this.titleNumsCache[e];var t=e.length,n=0;for(var i in e){var r=e[i],a=r.charCodeAt()-64;n+=a*Math.pow(26,t-i-1)}return this.numsTitleCache[n]=e,this.titleNumsCache[e]=n,n},setExportCellStyle:function(e,n,i,r){if("object"!=typeof e||!e.length||!e[0]||!Object.keys(e[0]).length)return[];var a=Object.keys(e[0]),o=e.length-1,l=a.length-1,s={c:0,r:0},u={c:o,r:l};if(n&&"string"==typeof n){var c=n.split(":");c[0].length&&(s=this.splitPosition(c[0])),"undefined"!=typeof c[1]&&""!==c[1]&&(u=this.splitPosition(c[1]))}s.c>u.c&&console.error("开始列不得大于结束列"),s.r>u.r&&console.error("开始行不得大于结束行");for(var h=s.c;h<=u.c;h++)for(var f=s.r;f<=u.r;f++){var p=e[h];if(!p){p={};for(var v in a)p[a[v]]="";e[h]=p}var d=p[a[f]],x=null;null!==d&&void 0!==d||(d=""),x="object"==typeof d?t.extend(!0,{},d,i):t.extend(!0,{},{v:d},i),"function"==typeof r&&(x=r(d,x,p,i,f,h,a[f])),e[h][a[f]]=x}return e},makeMergeConfig:function(e){var t=[];for(var n in e)t.push({s:this.splitPosition(e[n][0]),e:this.splitPosition(e[n][1])});return t},makeColConfig:function(e,t){t=t>0?t:50;var n=[],i=0;for(index in e){var r=e[index];if(index.match&&index.match(/[A-Z]*/)){for(var a=this.titleToNum(index)-1;i<a;)n.push({wpx:t}),i++;i=a+1,n.push({wpx:r>0?r:t})}}return n},makeRowConfig:function(e,t){t=t>0?t:10;var n=[],i=0;for(index in e){var r=e[index];if(index.match&&index.match(/[0-9]*/)){for(var a=parseInt(index)-1;i<a;)n.push({hpx:t}),i++;i=a+1,n.push({hpx:r>0?r:t})}}return n},splitPosition:function(e){var t=e.match("^([A-Z]+)([0-9]+)$");return t?{c:this.titleToNum(t[1])-1,r:parseInt(t[2])-1}:{c:0,r:0}},s2ab:function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=255&e.charCodeAt(i);return t},filterDataToAoaData:function(e){var t=[];return layui.each(e,function(e,n){var i=[];for(var r in n)i.push(n[r]);t.push(i)}),t},filterExportData:function(e,t){var n=[],i=[];if(Array.isArray(t))for(var r in t)i[t[r]]=t[r];else i=t;for(r in e){var a=e[r];n[r]={};for(key in i){var o=key,l=i[key];"function"==typeof l&&l.apply?n[r][o]=l.apply(window,[a[o],a,e]):"undefined"!=typeof a[l]?n[r][o]=a[l]:n[r][o]=""}}return n},filterImportData:function(e,t){var n=this;return layui.each(e,function(e,i){layui.each(i,function(e,r){i[e]=n.filterExportData(r,t)})}),e},importExcel:function(e,i,r){var a={header:"A",range:null,fields:null};t.extend(a,i);var o=this;if(e.length<1)throw{code:999,message:"传入文件为空"};var l=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd-xls","application/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",""];layui.each(e,function(e,t){if(l.indexOf(t.type)===-1)throw{code:999,message:t.name+"（"+t.type+"）为不支持的文件类型"}});var s={};layui.each(e,function(t,i){var l=new FileReader;if(!l)throw{code:999,message:"不支持FileReader，请更换更新的浏览器"};l.onload=function(i){var l=n.read(i.target.result,{type:"binary"}),u={};layui.each(l.Sheets,function(e,t){if(l.Sheets.hasOwnProperty(e)){var i={header:a.header};a.range&&(i.range=a.range),u[e]=n.utils.sheet_to_json(t,i),a.fields&&(u[e]=o.filterExportData(u[e],a.fields))}}),s[t]=u,t===e.length-1&&r&&r.apply&&r.apply(window,[s])},l.readAsBinaryString(i)})}})});